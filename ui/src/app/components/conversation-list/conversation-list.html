<div class="h-full flex flex-col">
  <!-- Header with Search -->
  <div class="p-4 border-b" style="border-color: var(--color-border-primary)">
    <h2 class="text-lg font-bold mb-3" style="color: var(--color-text-primary)">
      Conversations
    </h2>
    <app-search-bar></app-search-bar>
  </div>

  <!-- Conversation List -->
  <div class="flex-1 overflow-y-auto custom-scrollbar">
    @if (displayedConversations().length === 0) {
      <!-- Empty State -->
      <div class="flex flex-col items-center justify-center h-full text-center p-8">
        <svg
          class="w-16 h-16 mb-4"
          style="color: var(--color-text-tertiary)"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
          />
        </svg>
        @if (searchService.searchQuery() || searchService.filters().hasUnread || searchService.filters().status) {
          <p class="font-medium mb-2" style="color: var(--color-text-secondary)">
            No matching conversations
          </p>
          <p class="text-sm" style="color: var(--color-text-tertiary)">
            Try adjusting your search or filters
          </p>
          <button
            (click)="searchService.clearFilters()"
            class="btn btn-secondary mt-4 text-sm"
          >
            Clear filters
          </button>
        } @else {
          <p class="font-medium mb-2" style="color: var(--color-text-secondary)">
            No conversations yet
          </p>
          <p class="text-sm" style="color: var(--color-text-tertiary)">
            Start a conversation to see it here
          </p>
        }
      </div>
    } @else {
      <!-- Conversation Items -->
      <div class="p-2">
        @for (conv of displayedConversations(); track conv.id; let i = $index) {
          <div
            (click)="selectConversation(conv)"
            class="conversation-item"
            [class.conversation-item--selected]="isSelected(conv)"
            [class.conversation-item--focused]="focusedIndex() === i"
            tabindex="0"
          >
            <!-- Avatar -->
            <div class="avatar">
              @if (conv.contactAvatar) {
                <img
                  [src]="conv.contactAvatar"
                  [alt]="conv.contactName"
                />
              } @else {
                <div class="avatar-initials">
                  {{ conv.contactName.charAt(0).toUpperCase() }}
                </div>
              }
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between mb-1">
                <h3 class="font-medium truncate text-sm" style="color: var(--color-text-primary)">
                  {{ conv.contactName }}
                </h3>
                @if (conv.unreadCount > 0) {
                  <span class="badge badge-primary text-xs ml-2">
                    {{ conv.unreadCount }}
                  </span>
                }
              </div>
              <p class="text-xs truncate" style="color: var(--color-text-secondary)">
                {{ conv.lastMessage }}
              </p>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
