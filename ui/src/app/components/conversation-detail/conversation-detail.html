@if (conversationService.selectedConversation(); as conversation) {
<div class="h-full flex flex-col" style="background-color: var(--color-surface-primary)">
  <!-- Header -->
  <div
    class="p-4"
    style="
      background-color: var(--color-surface-primary);
      border-bottom: 1px solid var(--color-border-primary);
    "
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- Avatar with online status -->
        <div class="relative">
          @if (conversation.contactAvatar) {
          <img
            [src]="conversation.contactAvatar"
            [alt]="conversation.contactName"
            class="w-10 h-10 rounded-full object-cover"
          />
          } @else {
          <div class="avatar w-10 h-10 text-base">
            {{ conversation.contactName.charAt(0).toUpperCase() }}
          </div>
          }
          <!-- Online indicator positioned on avatar -->
          <div class="absolute -bottom-0.5 -right-0.5">
            <app-online-status-indicator
              [status]="getOnlineStatus()"
              size="sm"
            ></app-online-status-indicator>
          </div>
        </div>

        <div>
          <h2 class="font-semibold" style="color: var(--color-text-primary)">
            {{ conversation.contactName }}
          </h2>
          <div class="flex items-center gap-2">
            <span class="text-sm" style="color: var(--color-text-tertiary)">
              {{ conversation.contactId }}
            </span>
            <span class="text-xs" style="color: var(--color-text-tertiary)">
              &#8226;
            </span>
            <app-online-status-indicator
              [status]="getOnlineStatus()"
              [showLabel]="true"
              size="sm"
            ></app-online-status-indicator>
          </div>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="flex items-center gap-2">
        <!-- Bot toggle -->
        <button
          class="btn btn-ghost p-2 rounded-lg"
          [class.text-green-500]="conversation.botEnabled"
          [title]="conversation.botEnabled ? 'Bot enabled' : 'Bot disabled'"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            />
          </svg>
        </button>

        <!-- More options -->
        <button class="btn btn-ghost p-2 rounded-lg">
          <svg
            class="w-5 h-5"
            style="color: var(--color-text-secondary)"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Messages Area -->
  <div
    #messagesContainer
    class="flex-1 overflow-y-auto custom-scrollbar p-4"
    style="background-color: var(--color-bg-secondary)"
  >
    <div class="flex flex-col items-center justify-center h-full text-center">
      <svg
        class="w-16 h-16 mb-4"
        style="color: var(--color-text-tertiary)"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
        />
      </svg>
      <p class="font-medium" style="color: var(--color-text-secondary)">
        No messages yet
      </p>
      <p class="text-sm mt-1" style="color: var(--color-text-tertiary)">
        Messages will appear here
      </p>
    </div>
  </div>

  <!-- Typing indicator -->
  @if (isTyping()) {
  <div class="px-4 py-2" style="background-color: var(--color-bg-secondary)">
    <div class="flex items-center gap-2">
      <div class="typing-indicator">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <span class="text-sm" style="color: var(--color-text-tertiary)">
        {{ conversation.contactName }} is typing...
      </span>
    </div>
  </div>
  }

  <!-- Reply Box -->
  <div
    class="p-4"
    style="
      background-color: var(--color-surface-primary);
      border-top: 1px solid var(--color-border-primary);
    "
  >
    <div class="flex gap-3">
      <input
        #messageInput
        type="text"
        [value]="replyMessage()"
        (input)="replyMessage.set($any($event.target).value)"
        (keydown)="onKeydown($event)"
        placeholder="Type your message..."
        class="input flex-1"
      />
      <button
        (click)="sendMessage()"
        class="btn btn-primary px-4"
        [disabled]="!replyMessage().trim()"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
          />
        </svg>
      </button>
    </div>
    <div class="flex items-center justify-between mt-2">
      <div class="flex items-center gap-2">
        <button class="btn btn-ghost p-1.5 rounded">
          <svg
            class="w-4 h-4"
            style="color: var(--color-text-tertiary)"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"
            />
          </svg>
        </button>
        <button class="btn btn-ghost p-1.5 rounded">
          <svg
            class="w-4 h-4"
            style="color: var(--color-text-tertiary)"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
        </button>
      </div>
      <span class="text-xs" style="color: var(--color-text-tertiary)">
        Press Enter to send
      </span>
    </div>
  </div>
</div>
} @else {
<!-- No Conversation Selected -->
<div
  class="h-full flex flex-col items-center justify-center text-center p-8"
  style="background-color: var(--color-bg-secondary)"
>
  <div
    class="w-20 h-20 rounded-full flex items-center justify-center mb-4"
    style="background-color: var(--color-surface-secondary)"
  >
    <svg
      class="w-10 h-10"
      style="color: var(--color-text-tertiary)"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
      />
    </svg>
  </div>
  <h3 class="text-xl font-semibold mb-2" style="color: var(--color-text-primary)">
    No Conversation Selected
  </h3>
  <p style="color: var(--color-text-secondary)">
    Select a conversation from the list to view messages
  </p>
  <p class="text-sm mt-2" style="color: var(--color-text-tertiary)">
    Press <kbd class="kbd text-xs">J</kbd> / <kbd class="kbd text-xs">K</kbd> to navigate
  </p>
</div>
}
